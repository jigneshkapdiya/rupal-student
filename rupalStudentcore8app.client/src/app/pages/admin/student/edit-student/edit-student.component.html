<div class="card">
  <div class="card-content">
    <div class="card-body">
      <form [formGroup]="form" (ngSubmit)="onClick_Submit()">
        <!-- Personal Information Section -->
        <div class="row">
          <!-- Mobile Number -->
          <div class="col-md-6 form-group">
            <div class="d-flex justify-content-between">
              <label for="mobile">Mobile Number</label>
              <label for="mobile">મોબાઇલ નંબર</label>
            </div>
            <input type="text" class="form-control" formControlName="mobile" placeholder="Enter mobile number"
              [ngClass]="{'is-invalid': form.get('mobile')?.touched && form.get('mobile')?.invalid}">
            <div *ngIf="form.get('mobile')?.touched && form.get('mobile')?.invalid" class="invalid-feedback d-block">
              Mobile number is required
            </div>
          </div>

          <!-- Family Name -->
          <div class="col-md-6 form-group">
            <div class="d-flex justify-content-between">
              <label for="familyName">Surname</label>
              <label for="familyName">તમારી શાખે </label>
            </div>
            <ng-select id="familyName" formControlName="familyName" [items]="familyNameList" placeholder="Select" bindLabel="name" bindValue="name"
              (change)="onFamilyChange($event)"
              [ngClass]="{'is-invalid': form.get('familyName')?.touched && form.get('familyName')?.invalid,'is-valid': form.get('familyName')?.touched && form.get('familyName')?.valid}">
              <ng-template ng-option-tmp let-item="item">
                {{ item.name }} - {{ item.nameGU }}
              </ng-template>
            </ng-select>
            <div *ngIf="form.get('familyName')?.touched && form.get('familyName')?.invalid" class="text-danger">
              Family name is required
            </div>
          </div>

          <!-- Student Name -->
          <div class="col-md-6 form-group">
            <div class="d-flex justify-content-between">
              <label for="studentName">Student Name In English</label>
              <label for="studentName">વિદ્યાર્થીનું નામ અંગ્રેજીમાં</label>
            </div>
            <input type="text" class="form-control" formControlName="studentName" placeholder="Enter name in English"
              [ngClass]="{'is-invalid': form.get('studentName')?.touched && form.get('studentName')?.invalid,'is-valid': form.get('studentName')?.touched && form.get('studentName')?.valid }">
            <small class="form-text text-muted danger" *ngIf="(form.get('studentName')?.touched || form.get('studentNameGu')?.touched)
                && (form.get('studentName')?.errors?.required || form.get('studentNameGu')?.errors?.required)">
              Either Student Name (English) or Student Name (Gujarati) is required.
            </small>
          </div>

          <!-- Student Name In Gujarati -->
          <div class="col-md-6 form-group">
            <div class="d-flex justify-content-between">
              <label for="studentName">Student Name In Gujarati</label>
              <label for="studentName">વિદ્યાર્થીનું નામ ગુજરાતીમાં</label>
            </div>
            <input type="text" class="form-control" formControlName="studentNameGu" placeholder="Enter name in Gujarati"
              [ngClass]="{'is-invalid': form.get('studentNameGu')?.touched && form.get('studentNameGu')?.invalid,'is-valid': form.get('studentNameGu')?.touched && form.get('studentNameGu')?.valid}">
            <small class="form-text text-muted danger" *ngIf="(form.get('studentName')?.touched || form.get('studentNameGu')?.touched)
                && (form.get('studentName')?.errors?.required || form.get('studentNameGu')?.errors?.required)">
              Either Student Name (English) or Student(Gujarati) is required.
            </small>
          </div>

          <!-- Father's Name -->
          <div class="col-md-6 form-group">
            <div class="d-flex justify-content-between">
              <label for="fatherName">Father Name In English</label>
              <label for="fatherName">પિતાનું નામ અંગ્રેજીમાં</label>
            </div>
            <input type="text" class="form-control" formControlName="fatherName" placeholder="Enter father's name in English" [ngClass]="{'is-invalid': form.get('fatherName')?.touched && form.get('fatherName')?.invalid,
                          'is-valid': form.get('fatherName')?.touched && form.get('fatherName')?.valid}">
            <small class="form-text text-muted danger" *ngIf="(form.get('fatherName')?.touched || form.get('fatherNameGu')?.touched)
                && (form.get('fatherName')?.errors?.required || form.get('fatherNameGu')?.errors?.required)">
              Either Father Name (English) or Father Name (Gujarati) is required.
            </small>
          </div>

          <!-- Father's Name In Gujarati -->
          <div class="col-md-6 form-group">
            <div class="d-flex justify-content-between">
              <label for="fatherName">Father Name In Gujarati</label>
              <label for="fatherName">પિતાનું નામ ગુજરાતીમાં </label>
            </div>
            <input type="text" class="form-control" formControlName="fatherNameGu" placeholder="Enter father's name in Gujarati"
              [ngClass]="{'is-invalid': form.get('fatherNameGu')?.touched && form.get('fatherNameGu')?.invalid,'is-valid': form.get('fatherNameGu')?.touched && form.get('fatherNameGu')?.valid}">
            <small class="form-text text-muted danger" *ngIf="(form.get('fatherName')?.touched || form.get('fatherNameGu')?.touched)
                && (form.get('fatherName')?.errors?.required || form.get('fatherNameGu')?.errors?.required)">
              Either Father Name (English) or Father Name (Gujarati) is required.
            </small>
          </div>

          <!-- School and Education -->
          <div class="col-md-6 form-group">
            <div class="d-flex justify-content-between">
              <label for="schoolName">School Name</label>
              <label for="schoolName">શાળાનું નામ</label>
            </div>
            <input type="text" class="form-control" formControlName="schoolName" placeholder="Enter school name"
              [ngClass]="{'is-invalid': form.get('schoolName')?.touched && form.get('schoolName')?.invalid, 'is-valid': form.get('schoolName')?.touched &&  form.get('schoolName')?.valid }">
            <small class="form-text text-muted danger" *ngIf="form.get('schoolName')?.touched && form.get('schoolName')?.invalid">
              School name is required
            </small>
          </div>

          <!-- Education -->
          <div class="col-md-6 form-group">
            <div class="d-flex justify-content-between">
              <label for="education">Education</label>
              <label for="education">શિક્ષણ</label>
            </div>
            <ng-select [items]="educationList" bindLabel="name" bindValue="name" placeholder="Select Education" formControlName="education"
              [ngClass]="{'is-invalid': form.get('education')?.touched && form.get('education')?.invalid}">
            </ng-select>
            <div *ngIf="form.get('education')?.touched && form.get('education')?.invalid" class="text-danger small mt-1">
              Education is required
            </div>
          </div>
        </div>

        <!-- Marks Section -->
        <div class="row">
          <!-- Percentage -->
          <div class="col-md-4">
            <div class="d-flex justify-content-between">
              <label for="education">Percentage</label>
              <label for="education">ટકાવારી</label>
            </div>
            <div class="input-group">
              <input type="number" class="form-control" formControlName="percentage" placeholder="0.00" step="0.01" min="0" max="100"
                [ngClass]="{'is-invalid': (form.get('percentage')?.touched || form.get('percentage')?.dirty) && form.get('percentage')?.invalid}">
              <div class="input-group-append">
                <span class="input-group-text">%</span>
              </div>
            </div>
            <div *ngIf="form.get('percentage')?.touched || form.get('percentage')?.dirty" class="text-danger small mt-1">
              <div *ngIf="form.get('percentage')?.hasError('pattern')">Invalid format (e.g., 75.50)</div>
              <div *ngIf="form.get('percentage')?.hasError('min')">Cannot be less than 0</div>
              <div *ngIf="form.get('percentage')?.hasError('max')">Cannot exceed 100</div>
            </div>
          </div>

          <!-- SGPA -->
          <div class="col-md-4">
            <div class="d-flex justify-content-between">
              <label for="education">SGPA</label>
              <label for="education">એસજીપીએ</label>
            </div>
            <input type="number" class="form-control" formControlName="sgpa" placeholder="0.00" step="0.01" min="0" max="10"
              [ngClass]="{'is-invalid': (form.get('sgpa')?.touched || form.get('sgpa')?.dirty) && form.get('sgpa')?.invalid}">
            <div *ngIf="form.get('sgpa')?.touched || form.get('sgpa')?.dirty" class="text-danger small mt-1">
              <div *ngIf="form.get('sgpa')?.hasError('pattern')">Invalid format (e.g., 8.75)</div>
              <div *ngIf="form.get('sgpa')?.hasError('min')">Cannot be less than 0</div>
              <div *ngIf="form.get('sgpa')?.hasError('max')">Cannot exceed 10</div>
            </div>
          </div>

          <!-- CGPA -->
          <div class="col-md-4">
            <div class="d-flex justify-content-between">
              <label for="education">CGPA</label>
              <label for="education">સીજીપીએ</label>
            </div>
            <input type="number" class="form-control" formControlName="cgpa" placeholder="0.00" step="0.01" min="0" max="10"
              [ngClass]="{'is-invalid': (form.get('cgpa')?.touched || form.get('cgpa')?.dirty) && form.get('cgpa')?.invalid}">
            <div *ngIf="form.get('cgpa')?.touched || form.get('cgpa')?.dirty" class="text-danger small mt-1">
              <div *ngIf="form.get('cgpa')?.hasError('pattern')">Invalid format (e.g., 8.75)</div>
              <div *ngIf="form.get('cgpa')?.hasError('min')">Cannot be less than 0</div>
              <div *ngIf="form.get('cgpa')?.hasError('max')">Cannot exceed 10</div>
            </div>
          </div>

          <!-- At least one mark required message -->
          <div class="col-12" *ngIf="showMarksError()">
            <div class="alert alert-warning py-2 small mb-0">
              <i class="fas fa-exclamation-triangle me-1"></i>
              Please provide at least one: Percentage, SGPA, or CGPA
            </div>
          </div>
        </div>

        <!-- Approval Status Section -->
        <div class="row mt-3 mb-3">
          <div class="col-md-6">
            <label for="isApprovedToggle">Is Approved</label>
            <!-- Toggle Switch -->
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="isApprovedToggle" formControlName="isApproved">
              <label class="custom-control-label" for="isApprovedToggle"></label>
            </div>
          </div>
        </div>
        <div class="card" *ngIf="studentId > 0">
          <div class="card-content">
            <div class="card-header">
              <h5><i class="fa fa-paperclip mr-1" aria-hidden="true"></i>Attachment</h5>
            </div>
            <hr class="mt-0 mb-1" />
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover table-sm">
                  <thead>
                    <tr>
                      <th scope="col">Attachment Type</th>
                      <th scope="col">File</th>
                      <th scope="col">Description</th>
                      <th scope="col" class="text-center">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of studentAttachmentList  let i = index">
                      <td data-title="Attachment Type">{{item.referenceType}}</td>
                      <td data-title="File">
                        <a class="primary" href="{{item.fileUrl}}" target="_blank">{{item.fileName}}</a>
                      </td>
                      <td data-title="Description">{{item.description}}</td>
                      <td data-title="Action" class="text-center" [ngbTooltip]="'Delete Attachment'">
                        <a class="danger p-0" (click)="removeAttachment(item.id)">
                          <i class="ft-trash-2 font-medium-3"></i>
                        </a>
                      </td>
                    </tr>
                    <tr *ngIf="studentAttachmentList.length === 0">
                      <td colspan="4" class="text-center">No record's found</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <!-- Attachment Section -->
        <div class="row mb-4">
          <!-- Upload Section -->
          <div class="col-md-4">
            <label class="custom-file mb-3">
              <div ng2FileDrop [uploader]="uploader" class="well well-lg my-drop-zone">
                DRAG & DROP FILES HERE
              </div>
              <input type="file" ng2FileSelect [uploader]="uploader" multiple>
              <span class="custom-file-control"></span>
            </label>
          </div>

          <!-- File List Section -->
          <div class="col-md-8">
            <div class="table-responsive">
              <table class="table table-sm table-hover border-0">
                <thead class="thead-light">
                  <tr>
                    <th class="w-40">File</th>
                    <th class="w-40">Description</th>
                    <th class="text-center w-20">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of attachmentList">
                    <td>
                      <a class="primary" href="#" (click)="openFile($event, item.fileUrl, item.fileName)">{{
                        item?.fileName }}</a>
                    </td>
                    <td>
                      <input type="text" class="form-control form-control-sm" [(ngModel)]="item.description" [ngModelOptions]="{ standalone: true }"
                        placeholder="Enter description" />
                    </td>
                    <td class="text-center">
                      <button class="btn btn-sm btn-outline-danger" (click)="removeAttachment(item)" ngbTooltip="Remove">
                        <i class="ft-x-circle"></i>
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="attachmentList?.length === 0">
                    <td colspan="3" class="text-center text-muted">No attachments uploaded</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="d-flex justify-content-end">
          <button type="submit" class="btn btn-primary m-1">
            <i class="ft-check-square mr-1" aria-hidden="true"></i> Save
          </button>
        </div>
      </form>
    </div>
  </div>
</div>